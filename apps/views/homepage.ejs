<!DOCTYPE html>
<html lang="en">
<head>
  <title>ORBIT JSC</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/nhap3.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <!-- <script src="/static/js/nhap3.js"></script> -->
  <!-- <script src="/static/js/browserMqtt.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
  </script>
  <script src="/static/js/nhap3.js" type="text/javascript"></script>
  <script type = "text/javascript" language = "javascript">
  
    var mqtt;
    var reconnectTimeout = 200;
    var host="192.168.31.249"; //change this
    //var host="iot.eclipse.org"node 
    //var port=80
    var port=1889;
    let qtcc="";
    var cc="";
    var mt,mt2,mt3;
    //var cc=0;
    function onFailure(message) {
        console.log("Connection Attempt to Host "+host+"Failed");
        setTimeout(MQTTconnect, reconnectTimeout);
    }
    function onMessageArrived(msg){
        out_msg="Message received "+msg.payloadString+"<br>";
        out_msg=out_msg+"Message received Topic "+msg.destinationName;
        //console.log(out_msg);
       // qt="Message received "+msg.payloadString+"<br>";
        //cc= new Number(msg.payloadString);
        // cc=msg.payloadString;
        // console.log(msg.destinationName);
         if(msg.destinationName=="status2")
         {
          cc=msg.payloadString+"<br>";
          mt= parseInt(cc);
          console.log("SV : "+cc+"°C");
         }
         if(msg.destinationName=="status")
         {
          qtcc=msg.payloadString+"<br>";
          console.log("PV : "+qtcc+"°C");
          mt2= parseInt(qtcc);
          mt3=mt2-mt;
         }
          
          // if(msg.destinationName=="status2")
          // cc="Message received "+msg.payloadString+"<br>";


    }
    
     function onConnect() {
  // Once a connection has been made, make a subscription and send a message.

    console.log("Connected ");
    mqtt.subscribe("status");
    mqtt.subscribe("status2");
    
    message = new Paho.MQTT.Message("Hello World");
    message.destinationName = "sensor1";
    mqtt.send(message);
  }
  var tq;
 tq="client"+ Math.floor(Math.random() * 10000);
  function MQTTconnect() {
    console.log("connecting to "+ host +" "+ port);
    mqtt = new Paho.MQTT.Client(host,port,tq);
    //document.write("connecting to "+ host);
    var options = {
        timeout: 3,
        onSuccess: onConnect,
        onFailure: onFailure,
         };
    mqtt.onMessageArrived = onMessageArrived
    
    mqtt.connect(options); //connect

    

    google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          
          ['Speed Monitor', 68]
        ]);

        var options = {
          width: 200, height: 200,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('chart_div'));

        chart.draw(data, options);

        setInterval(function() {
           var cm=typeof cc;
           if (cm!='number') {
             cc=0;
           }

           console.log(typeof cc);
          
            data.setValue(0, 1, 0 + cc);
           
         
          chart.draw(data, options);
        }, 500);
        
      }

    }
 
  </script>
   
</head>
<body>
  
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">METROFA SJC</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Features</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Pricing</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
</nav>
    <!-- ----------------------------------------------------------------------------- navbar
   -->
  </div>
<div class="container">
  <div class="row">
    <div class="col-md-4 intr"><img src="/static/imgs/scada.png" class="img-fluid img-thumbnail rounded"alt="">
      <h6>Xây dựng Demo SCADA</h6>
      <div class="spinner-border text-success"></div>
    </div>
    <div class="col-md-4 intr"><img src="/static/imgs/agv.png" class="img-fluid img-thumbnail" alt="">
      <h6>AGV chế tạo mẫu</h6>
      <div class="spinner-border text-primary"></div>
    </div>
    <div class="col-md-4 intr"><img src="/static/imgs/vision.png" class="img-fluid img-thumbnail" alt="">
      <h6>Vision và ứng dụng</h6>
      <div class="spinner-border text-dark"></div>
    </div>
  </div>
  <!-- <div class="container">
    <!-- <form name="connform" action="" onsubmit="return MQTTconnect()">

        Server:  <input type="text" name="server"><br><br>
        Port:    <input type="text" name="port"><br><br>
        <input type="submit" value="Connect">
        </form>
        <hr> -->
        <!-- <div class="col-md-4"></div>
        <div class="col-md-4">
           <p id="info"></p>
        </div>
        <div class="col-md-4"></div>
  </div> --> 
  
  <div class="container">
    <div class="bar1">
    </div>
    <hr>
    <div class="row">
      <div class="col-md-12 main">
        <div class="row data">
          <div class="col-md-12 DATA_PRODUCTS ">
            <div class="p text-center">Temperature Controll</div>
          </div>

        </div>
          <div class="row data">
            <div class=" tt col-md-3 ">
            <p>TODAY</p>
            <span  id="vnclock"></span>
          </div>
            
            <div class="plan col-md-9">
              <div class="row">
              <div class="col-md-6 data">
                <p class="c1">PV : </p>
                <p id="pv" class="c1 today" style="color: white; font-size: 10rem;" >1000</p>
                <p class="c1">°C</p>
              </div>
              <div class="col-md-6 data">
                <p class="c1">DEVIATION: </p>
                <p class="c1 today" id="mt">0</p>
                <p class="c1">°C</p>
              </div>
              <div class="col-md-6 data">
                <p class="c2" >SV : </p>
                <p class="c2 today" id="inf" style="color: rgb(13, 241, 13); font-size: 7rem;">10</p>
                <p class="c2">°C</p>
              </div>
              <div class="col-md-6 data">
                <p class="c1">CYCLE TIME : </p>
                <p class="c1 today">2</p>
                <p class="c1">m</p>
              </div>
              <div class="col-md-12 data">
                <p class="c1">INDEX COMPLETE TARGET : </p>
                <p class="c1 today">1</p>
                <p class="c1">%</p>
              </div>
              </div>
            </div>
          

        </div>
          <!-- <div class="row element_one">
            <div class="col-md-6">
              <div id="chart_div" class="text-center" style="width: 200px; height: 200px;"></div>
            </div>
            <div class="col-md-6">
              <h5>Motor ROLLER </h5>
              <button type="button" class="btn btn-success">RUN</button>
              <button type="button" class="btn btn-info ">STOP</button>
              <button type="button" class="btn btn-secondary ">REVERSE</button>
              <button type="button" class="btn btn-danger ">FORWORD</button>
              <div class="slidecontainer">
                 <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
              </div>
              <h6 class="text-center"> speed adjust</h6>
            </div>
          </div> -->
         <!--  <div class="row element_two">
            <div class="col-md-6">
              <div class="form-check">
                <label class="form-check-label">
                  <input type="radio" class="form-check-input indam" name="optradio">Head Point
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input type="radio" class="form-check-input indam" name="optradio">End Point
                </label>
              </div>
            </div>
            <div class="col-md-6">
              <h5>Cylinder 1 </h5>
              <button type="button" class="btn btn-success pull-right">ON</button>
              <button type="button" class="btn btn-info ">OFF</button>
              <h6 class="text-center"> </h6>
            </div>
          </div> -->
          <div class="row">
            <div class="col-md-12 sst">
              <h5 class="">Status</h5>
            </div>       
          </div>
          <div class="row">
            <div class="col-md-4">
              <img src="/static/imgs/pr.png" class="img-fluid img-thumbnail rounded" alt="">
              <h5></h5>
            </div>
            <div class="col-md-4">
               <img src="/static/imgs/tem.jpg" class="img-fluid img-thumbnail rounded" alt="">
            </div>
            <div class="col-md-4">
               <img src="/static/imgs/hu.jpg" class="img-fluid img-thumbnail rounded" alt="">
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 sst">
              <h5 class="">STATISTIC</h5>
            </div>       
          </div>
          <div class="row">
            <div class="col-md-12">
              <table class="table">
                <thead class="thead-dark">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>

              <table class="table">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody>

                    <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
      </div>
      <!-- <div class="col-md-3 menu">
        <h6>Tiêu điểm</h6>
      </div> -->
    </div>
  </div>
</div>

  <!-- <div class="container">
    <div class="bar1">
    </div>
    <hr>
    <div class="row">
      <div class="col-md-9 main">
          <div class="row element_one">
            <div class="col-md-6">
              <div id="chart_div" class="text-center" style="width: 200px; height: 200px;"></div>
            </div>
            <div class="col-md-6">
              <h5>Motor ROLLER </h5>
              <button type="button" class="btn btn-success">RUN</button>
              <button type="button" class="btn btn-info ">STOP</button>
              <button type="button" class="btn btn-secondary ">REVERSE</button>
              <button type="button" class="btn btn-danger ">FORWORD</button>
              <div class="slidecontainer">
                 <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
              </div>
              <h6 class="text-center"> speed adjust</h6>
            </div>
          </div>
          <div class="row element_two">
            <div class="col-md-6">
              <div class="form-check">
                <label class="form-check-label">
                  <input type="radio" class="form-check-input indam" name="optradio">Head Point
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input type="radio" class="form-check-input indam" name="optradio">End Point
                </label>
              </div>
            </div>
            <div class="col-md-6">
              <h5>Cylinder 1 </h5>
              <button type="button" class="btn btn-success pull-right">ON</button>
              <button type="button" class="btn btn-info ">OFF</button>
              <h6 class="text-center"> </h6>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 sst">
              <h5 class="">Status</h5>
            </div>       
          </div>
          <div class="row">
            <div class="col-md-4">
              <img src="/static/imgs/pr.png" class="img-fluid img-thumbnail rounded" alt="">
              <h5></h5>
            </div>
            <div class="col-md-4">
               <img src="/static/imgs/tem.jpg" class="img-fluid img-thumbnail rounded" alt="">
            </div>
            <div class="col-md-4">
               <img src="/static/imgs/hu.jpg" class="img-fluid img-thumbnail rounded" alt="">
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 sst">
              <h5 class="">STATISTIC</h5>
            </div>       
          </div>
          <div class="row">
            <div class="col-md-12">
              <table class="table">
                <thead class="thead-dark">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>

              <table class="table">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody>

                    <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
      </div>
      <div class="col-md-3 menu">
        <h6>Tiêu điểm</h6>
      </div>
    </div>
  </div>
</div> -->
<!-- <script>
    var client = mqtt.connect('ws://192.168.1.104:1889') // you add a ws:// url here
    client.subscribe("tinhte")
  
    client.on("message", function (topic, payload) {
      alert([topic, payload].join(": "))
      client.end()
    })
  
    client.publish("tinhte", "hello world!")
  </script> -->
  <script>
		// var cm=typeof cc;
    //        if (cm!='number') {
    //          cc=0;
    //        }
    MQTTconnect();
    setInterval(function(){document.getElementById("pv").innerHTML = qtcc; }, 10);
    setInterval(function(){document.getElementById("inf").innerHTML = cc; }, 10);
    setInterval(function(){document.getElementById("mt").innerHTML = mt3; }, 10);
	
	</script>
</body>
</html>
